<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案 | Tianxingleo的Blog</title><meta name="keywords" content="3dgs,5070,blackwell,wsl,pytorch,cuda,SAM3D,linux"><meta name="author" content="Tianxingleo"><meta name="copyright" content="Tianxingleo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案"><meta name="application-name" content="【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案"><meta property="og:url" content="http://tianxingleo.top/2025/12/08/%E3%80%90%E9%A6%96%E5%8F%91%E3%80%91%E5%9C%A8-RTX-5070-Blackwell-WSL2-%E4%B8%8A%E8%B7%91%E9%80%9A%E6%9C%80%E6%96%B0%E6%A8%A1%E5%9E%8B-Meta-SAM-3D-%E7%9A%84%E7%BB%88%E6%9E%81%E6%96%B9%E6%A1%88/index.html"><meta property="og:site_name" content="Tianxingleo的Blog"><meta property="og:description" content="关键词：RTX 5070, WSL2, PyTorch Stable (CUDA 12.8), SAM 3D, Runtime Mocking, 显存流水线优化  1. 背景与技术挑战 Meta 最新发布的 SAM 3D Objects 是单图生成 3D 的 SOTA 模型。然而，在 2025 年发"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/114477837_p0_master1200.webp?_r_=585ff05b-6057-357e-76d9-daf6077fda93"><meta property="article:author" content="Tianxingleo"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/114477837_p0_master1200.webp?_r_=585ff05b-6057-357e-76d9-daf6077fda93"><meta name="description" content="关键词：RTX 5070, WSL2, PyTorch Stable (CUDA 12.8), SAM 3D, Runtime Mocking, 显存流水线优化  1. 背景与技术挑战 Meta 最新发布的 SAM 3D Objects 是单图生成 3D 的 SOTA 模型。然而，在 2025 年发"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://tianxingleo.top/2025/12/08/%E3%80%90%E9%A6%96%E5%8F%91%E3%80%91%E5%9C%A8-RTX-5070-Blackwell-WSL2-%E4%B8%8A%E8%B7%91%E9%80%9A%E6%9C%80%E6%96%B0%E6%A8%A1%E5%9E%8B-Meta-SAM-3D-%E7%9A%84%E7%BB%88%E6%9E%81%E6%96%B9%E6%A1%88/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?2abdc2befae45d70b9fd72c864f6fac0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-NVDE0BFR5M"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NVDE0BFR5M');
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"tianli","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"S-IQC7J39MX5C7PRZM","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: {"appId":"66YB7CN8AP","apiKey":"61956196bfa43507ef197aade2f06e78","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Tianxingleo","link":"链接: ","source":"来源: Tianxingleo的Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Tianxingleo的Blog',
  title: '【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案',
  postAI: '',
  pageFillDescription: ' 1. 背景与技术挑战,  2. 基础环境构建 (Infrastructure),  2.1 WSL2 环境准备,  2.2 安装 PyTorch (稳定版 CUDA 12.8),  2.3 编译核心光栅化引擎：Gsplat,  3. SAM 3D 模型部署 (Model Setup),  3.1 安装 SAM 3D 主体,  3.2 下载模型权重 (Hugging Face),  4. 技术创新：全栈优化脚本 (),  5. 运行与结果验证,  5.1 启动推理,  5.2 预期输出,  在 RTX 5070 + WSL 环境下强行跑通 SAM 3D：一场跨越软硬件代沟的踩坑实录,  第一阶段：依赖缺失与伪造战术 (The Mocking Game),  坑 1：PyTorch3D 模块缺失与 Visualization 报错,  坑 2：Transform3d 的链式调用陷阱,  第二阶段：数据流与类型的严苛校验,  坑 3：Mask 的数值溢出,  坑 4：维度与类型断言 (AssertionError),  第三阶段：显存危机 (OOM) 与 5070 的架构墙,  坑 5：12GB 显存的极限与贪婪加载,  坑 6：Blackwell 架构 (sm_120) 的排斥反应,  第四阶段：编译地狱 (Nightly Build vs Legacy Code),  坑 7：Kaolin 与 PyTorch3D 的 C++ ABI 冲突,  坑 8：Gsplat 的死循环,  第五阶段：终局之战 (The Hybrid Solution),  最终解决方案：真 Gsplat + 假辅助库,  结果,  总结 (Takeaway)关键词显存流水线优化背景与技术挑战最新发布的是单图生成的模型然而在年发布的系列显卡上部署该模型面临巨大挑战架构代差采用架构旧版无法识别依赖地狱依赖的和等库尚未适配导致源码编译失败显存瓶颈模型加载需要占用大量显存直接运行极易导致显存溢出本文提出一种降维打击的解决方案利用稳定版驱动硬件通过源码编译解决核心渲染器兼容性利用运行时伪造技术绕过非核心库的编译难题并通过显存分级流水线实现大模型在消费级显卡上的流畅运行基础环境构建环境准备确保显卡驱动已更新至支持的版本在中执行创建干净的环境兼容性最佳升级基础构建工具安装稳定版针对系显卡直接使用官方支持的稳定版这是驱动架构的核心安装此时官方已支持验证运行应输出编译核心光栅化引擎的核心生成能力依赖由于二进制包不兼容架构必须强制源码编译建立工作目录强制源码编译强制不使用预编译包使用当前环境的进行编译模型部署安装主体采用无依赖安装模式防止自动降级我们已配置好的和仅安装代码逻辑不安装依赖手动补齐纯依赖避开下载模型权重配置并下载完整权重登录需要下载模型权重关键修复补全缺失的配置文件官方权重包常缺失此文件技术创新全栈优化脚本这是本方案的核心技术创新点我们编写一个单一的脚本集成了以下技术在内存中动态创建虚假的和模块骗过的检查从而无需编译这些在上难以构建的库拦截强制将所有模型权重加载到系统内存防止初始化阶段劫持推理管线函数透传中间结果强制关闭生成步骤因其依赖仅保留生成请将以下代码保存为放在的工程目录下技术创新运行时依赖注入原理仅在数据加载和导出阶段依赖核心推理生成仅依赖通过骗过解释器可免去复杂的编译过程系统检测正在注入虚拟和运行时通用类吞噬所有调用返回零张量或自身伪造模块树填充关键接口伪造模块树填充数学变换与渲染类虚拟化运行时依赖注入完成注入配置区域请根据实际路径修改配置路径错误找不到仓库路径创建一个强制使用的临时配置文件防止初始化时简单的亮度阈值自动去背景优先检测通道启动任务加载模型初始化模式技术创新拦截权重加载强制所有模型权重加载到系统内存避免初始化时打爆显存欺骗对象恢复钩子模型加载完成驻留图像预处理降采样保护显存处理优先否则自动计算技术创新显存分级流水线显存无法同时容纳必须手动调度搬运模型至生成稀疏结构显存切换卸载加载技术创新禁用绕过依赖生成劫持直接注入结果避免重复计算结果保存成功模型已保存失败未生成数据运行出错总耗时运行与结果验证启动推理在终端中导航到下脚本所在目录并运行有助于防止超时预期输出注入成功看到虚拟化运行时依赖注入完成显存优化初始化时显存占用极低切换时显存会有明显释放和重新占用结果生成在当前目录下生成文件在环境下强行跑通一场跨越软硬件代沟的踩坑实录背景开源的是一个极其惊艳的单图转模型然而当它遇到年发布的架构时发生了一场灾难性的化学反应显卡太新库太老依赖冲突兼容性这是一个关于如何在一个不支持的环境中通过欺骗魔改和移花接木最终跑通代码的故事环境配置运行推理核心矛盾项目依赖但必须使用才能识别第一阶段依赖缺失与伪造战术项目初始依赖安装中和是两个最大的拦路虎由于环境复杂直接编译失败为了快速验证逻辑我选择了伪造策略坑模块缺失与报错现象运行脚本直接报错提示找不到或的子模块分析的推理代码引用了大量的辅助工具类如相机变换可视化器但这些库在混合环境下极难编译措施不编译库直接在脚本头部注入对象伪造了伪造了及其辅助函数核心逻辑只要推理核心不调用这些可视化函数空壳类就能骗过的检查坑的链式调用陷阱现象了类但报错分析的变换类支持链式调用如简单的函数返回了导致链条断裂措施重写类使其在调用方法如时返回仅在时返回第二阶段数据流与类型的严苛校验解决了问题后数据喂进去了但格式全是错坑的数值溢出现象分析我手动创建了内部逻辑有一行灾难发生了整数溢出变成了也就是几乎全透明导致点云被过滤光了措施修改初始化逻辑直接传入并确保内部不再重复缩放或者传入让其缩放最终方案是直接对接底层故需传入坑维度与类型断言现象拼接图像时维度不匹配分析的对输入非常挑剔它会自动给增加维度如果我们预处理时手动加了维度就会导致维度过多习惯性地将图像归一化到但模型强行要求措施去归一化保持输入为维度回退保持为让自己去处理升维第三阶段显存危机与的架构墙这是最绝望的阶段代码通了但硬件撑不住或者硬件不兼容坑显存的极限与贪婪加载现象分析只有显存初始化时极其贪婪试图一次性把和的所有模型包括巨大的全部加载进显存初始化阶段就爆了措施分阶段加载重写逻辑初始化通过配置文件强制模型初始化在内存中只把相关的模型搬运到跑完后立即卸载回搬运模型到执行后续这让显存也能跑动大模型坑架构的排斥反应现象分析项目默认依赖最高支持是旧版根本没有包含能在这张卡上运行的二进制代码尝试试图设置进行编译失败结论必须使用第四阶段编译地狱为了迁就显卡换了结果引发了依赖库的全面崩盘坑与的冲突现象换了后报错或分析预编译包失效官方包是针对旧编译的不兼容源码编译失败源码中包含过时的等被的编译器拒绝尝试修改解除版本限制失败编译错误降级失败寻找下载了针对的包依然冲突坑的死循环现象自动触发编译但因为找不到而失败措施手动克隆源码使用强制使用当前环境的进行编译结果这是唯一成功的编译成功适配了第五阶段终局之战既然和无论如何都无法在上编译成功而核心推理库却编译成功了我们采用了一个大胆的半真半假策略最终解决方案真假辅助库思路的核心生成逻辑依赖而和更多用于数据加载网格生成和可视化既然我们要的是我们可以放弃生成从而不需要这两个库的核心功能操作步骤环境基石使用成功编译了的环境全面伪造在头部注入大量代码伪造的以及的等甚至伪造了数学函数反正推理阶段可能用不到或者用不到高精度移花接木为了防止内部调用真实的生成逻辑我们在之前设置通过函数将的结果直接透传给避免重复计算和显存爆炸去背景输入图片如果是全白会导致生成一个实心长方体把背景也算进去了最终解使用生成透明利用通道作为结果未安装未安装本地编译成功生成文件在中完美查看总结在系这种超前硬件上运行旧代码核心心法只有两条核心算子必须真涉及到核心计算的如的光栅化必须基于重新编译绝无捷径辅助组件可以假对于只负责格式转换或非核心渲染的重型库如如果编译不过往往比源码更高效',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-12-17 23:13:39',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="Tianxingleo的Blog" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://avatars.githubusercontent.com/u/237200863?v=4"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://tianxingleo.github.io" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/237200863?v=4" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/tianxingleo" title="Github"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://github.githubassets.com/assets/GitHub-Mark-ea2971cee799.png" alt="Github"/><span class="back-menu-item-text">Github</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Tianxingleo的Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/3dgs/" style="font-size: 1.05rem;">3dgs<sup>7</sup></a><a href="/tags/5070/" style="font-size: 1.05rem;">5070<sup>1</sup></a><a href="/tags/Nerfstudio/" style="font-size: 1.05rem;">Nerfstudio<sup>1</sup></a><a href="/tags/SAM3D/" style="font-size: 1.05rem;">SAM3D<sup>1</sup></a><a href="/tags/blackwell/" style="font-size: 1.05rem;">blackwell<sup>2</sup></a><a href="/tags/c/" style="font-size: 1.05rem;">c<sup>4</sup></a><a href="/tags/colmap/" style="font-size: 1.05rem;">colmap<sup>4</sup></a><a href="/tags/cpc/" style="font-size: 1.05rem;">cpc<sup>4</sup></a><a href="/tags/cpp/" style="font-size: 1.05rem;">cpp<sup>14</sup></a><a href="/tags/css/" style="font-size: 1.05rem;">css<sup>1</sup></a><a href="/tags/cuda/" style="font-size: 1.05rem;">cuda<sup>1</sup></a><a href="/tags/dp/" style="font-size: 1.05rem;">dp<sup>1</sup></a><a href="/tags/google-colab/" style="font-size: 1.05rem;">google colab<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem;">html<sup>1</sup></a><a href="/tags/key%E7%A4%BE/" style="font-size: 1.05rem;">key社<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>5</sup></a><a href="/tags/mask/" style="font-size: 1.05rem;">mask<sup>1</sup></a><a href="/tags/nerfstudio/" style="font-size: 1.05rem;">nerfstudio<sup>1</sup></a><a href="/tags/pytorch/" style="font-size: 1.05rem;">pytorch<sup>3</sup></a><a href="/tags/sam/" style="font-size: 1.05rem;">sam<sup>1</sup></a><a href="/tags/sam3/" style="font-size: 1.05rem;">sam3<sup>1</sup></a><a href="/tags/tic/" style="font-size: 1.05rem;">tic<sup>1</sup></a><a href="/tags/wsl/" style="font-size: 1.05rem;">wsl<sup>5</sup></a><a href="/tags/yolo/" style="font-size: 1.05rem;">yolo<sup>1</sup></a><a href="/tags/%E4%B8%8D%E5%AE%9A%E7%A7%AF%E5%88%86/" style="font-size: 1.05rem;">不定积分<sup>1</sup></a><a href="/tags/%E5%87%BD%E6%95%B0/" style="font-size: 1.05rem;">函数<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 1.05rem;">前端<sup>1</sup></a><a href="/tags/%E5%8A%A8%E6%BC%AB/" style="font-size: 1.05rem;">动漫<sup>1</sup></a><a href="/tags/%E5%A4%A7%E5%AD%A6/" style="font-size: 1.05rem;">大学<sup>8</sup></a><a href="/tags/%E5%A4%A9%E4%BD%BF%E7%9A%84%E5%BF%83%E8%B7%B3/" style="font-size: 1.05rem;">天使的心跳<sup>1</sup></a><a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size: 1.05rem;">字符串<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">学习<sup>6</sup></a><a href="/tags/%E6%8C%87%E9%92%88/" style="font-size: 1.05rem;">指针<sup>2</sup></a><a href="/tags/%E6%90%9C%E7%B4%A2/" style="font-size: 1.05rem;">搜索<sup>1</sup></a><a href="/tags/%E7%A7%AF%E5%88%86/" style="font-size: 1.05rem;">积分<sup>2</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>6</sup></a><a href="/tags/%E7%BB%93%E6%9E%84%E4%BD%93/" style="font-size: 1.05rem;">结构体<sup>1</sup></a><a href="/tags/%E8%B4%A8%E6%95%B0%E7%AD%9B/" style="font-size: 1.05rem;">质数筛<sup>2</sup></a><a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 1.05rem;">链表<sup>1</sup></a><a href="/tags/%E9%AB%98%E6%95%B0/" style="font-size: 1.05rem;">高数<sup>7</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/12/"><span class="card-archive-list-date">十二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">13</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">十一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/3dgs/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>3dgs</span></a><a class="article-meta__tags" href="/tags/5070/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>5070</span></a><a class="article-meta__tags" href="/tags/blackwell/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>blackwell</span></a><a class="article-meta__tags" href="/tags/wsl/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>wsl</span></a><a class="article-meta__tags" href="/tags/pytorch/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>pytorch</span></a><a class="article-meta__tags" href="/tags/cuda/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>cuda</span></a><a class="article-meta__tags" href="/tags/SAM3D/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>SAM3D</span></a><a class="article-meta__tags" href="/tags/linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>linux</span></a></span></div></div><h1 class="post-title" itemprop="name headline">【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-12-08T06:29:13.000Z" title="发表于 2025-12-08 14:29:13">2025-12-08</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-12-17T15:13:39.000Z" title="更新于 2025-12-17 23:13:39">2025-12-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为广州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广州</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/12/08/%E3%80%90%E9%A6%96%E5%8F%91%E3%80%91%E5%9C%A8-RTX-5070-Blackwell-WSL2-%E4%B8%8A%E8%B7%91%E9%80%9A%E6%9C%80%E6%96%B0%E6%A8%A1%E5%9E%8B-Meta-SAM-3D-%E7%9A%84%E7%BB%88%E6%9E%81%E6%96%B9%E6%A1%88/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/114477837_p0_master1200.webp?_r_=585ff05b-6057-357e-76d9-daf6077fda93"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://tianxingleo.top/2025/12/08/%E3%80%90%E9%A6%96%E5%8F%91%E3%80%91%E5%9C%A8-RTX-5070-Blackwell-WSL2-%E4%B8%8A%E8%B7%91%E9%80%9A%E6%9C%80%E6%96%B0%E6%A8%A1%E5%9E%8B-Meta-SAM-3D-%E7%9A%84%E7%BB%88%E6%9E%81%E6%96%B9%E6%A1%88/"><header><a href="/tags/3dgs/" tabindex="-1" itemprop="url">3dgs</a><a href="/tags/5070/" tabindex="-1" itemprop="url">5070</a><a href="/tags/blackwell/" tabindex="-1" itemprop="url">blackwell</a><a href="/tags/wsl/" tabindex="-1" itemprop="url">wsl</a><a href="/tags/pytorch/" tabindex="-1" itemprop="url">pytorch</a><a href="/tags/cuda/" tabindex="-1" itemprop="url">cuda</a><a href="/tags/SAM3D/" tabindex="-1" itemprop="url">SAM3D</a><a href="/tags/linux/" tabindex="-1" itemprop="url">linux</a><h1 id="CrawlerTitle" itemprop="name headline">【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Tianxingleo</span><time itemprop="dateCreated datePublished" datetime="2025-12-08T06:29:13.000Z" title="发表于 2025-12-08 14:29:13">2025-12-08</time><time itemprop="dateCreated datePublished" datetime="2025-12-17T15:13:39.000Z" title="更新于 2025-12-17 23:13:39">2025-12-17</time></header><p><strong>关键词</strong>：RTX 5070, WSL2, PyTorch Stable (CUDA 12.8), SAM 3D, Runtime Mocking, 显存流水线优化</p>
<h2 id="1-背景与技术挑战"><a class="markdownIt-Anchor" href="#1-背景与技术挑战"></a> 1. 背景与技术挑战</h2>
<p>Meta 最新发布的 <strong>SAM 3D Objects</strong> 是单图生成 3D 的 SOTA 模型。然而，在 2025 年发布的 RTX 50 系列显卡上部署该模型面临巨大挑战：</p>
<ol>
<li><strong>架构代差</strong>：RTX 5070 采用 Blackwell 架构 (sm_120)，旧版 PyTorch 无法识别。</li>
<li><strong>依赖地狱</strong>：SAM 3D 依赖的 Kaolin 和 PyTorch3D 等库尚未适配 CUDA 12.8+，导致源码编译失败。</li>
<li><strong>显存瓶颈</strong>：模型加载需要占用大量显存，直接运行极易导致 12GB 显存溢出 (OOM)。</li>
</ol>
<p>本文提出一种**“降维打击”<strong>的解决方案：利用 PyTorch 稳定版驱动硬件，通过</strong>源码编译<strong>解决核心渲染器 (gsplat) 兼容性，利用</strong>Runtime Mocking (运行时伪造)** 技术绕过非核心库的编译难题，并通过<strong>显存分级流水线</strong>实现大模型在消费级显卡上的流畅运行。</p>
<h2 id="2-基础环境构建-infrastructure"><a class="markdownIt-Anchor" href="#2-基础环境构建-infrastructure"></a> 2. 基础环境构建 (Infrastructure)</h2>
<h3 id="21-wsl2-环境准备"><a class="markdownIt-Anchor" href="#21-wsl2-环境准备"></a> 2.1 WSL2 环境准备</h3>
<p>确保 Windows 显卡驱动已更新至支持 CUDA 12.8 的版本。在 WSL2 (Ubuntu 22.04/24.04) 中执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 创建干净的 Python 3.10 环境 (兼容性最佳)</span><br><span class="line">conda create -n sam3d_rtx50 python=3.10 -y</span><br><span class="line">conda activate sam3d_rtx50</span><br><span class="line"></span><br><span class="line"># 升级基础构建工具</span><br><span class="line">pip install --upgrade pip setuptools wheel ninja</span><br></pre></td></tr></table></figure>
<h3 id="22-安装-pytorch-稳定版-cuda-128"><a class="markdownIt-Anchor" href="#22-安装-pytorch-稳定版-cuda-128"></a> 2.2 安装 PyTorch (稳定版 CUDA 12.8)</h3>
<p>针对 RTX 50 系显卡，直接使用官方支持 CUDA 12.8 的稳定版 PyTorch。这是驱动 sm_120 架构的核心。</p>
<p>codeBash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装 PyTorch Stable (2025.12 此时官方已支持 CUDA 12.8)</span><br><span class="line">pip3 install torch torchvision</span><br></pre></td></tr></table></figure>
<p><em>验证：运行 python -c “import torch; print(torch.cuda.get_device_capability())” 应输出 (12, 0)。</em></p>
<h3 id="23-编译核心光栅化引擎gsplat"><a class="markdownIt-Anchor" href="#23-编译核心光栅化引擎gsplat"></a> 2.3 编译核心光栅化引擎：Gsplat</h3>
<p>SAM 3D 的核心生成能力依赖 gsplat。由于二进制包不兼容 Blackwell 架构，必须<strong>强制源码编译</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 1. 建立工作目录</span><br><span class="line">mkdir -p ~/workspace/ai &amp;&amp; cd ~/workspace/ai</span><br><span class="line"></span><br><span class="line"># 2. 强制源码编译 gsplat</span><br><span class="line"># --no-binary: 强制不使用预编译包</span><br><span class="line"># --no-build-isolation: 使用当前环境的 PyTorch 进行编译</span><br><span class="line">pip install gsplat --no-binary=gsplat --no-cache-dir --no-build-isolation</span><br></pre></td></tr></table></figure>
<h2 id="3-sam-3d-模型部署-model-setup"><a class="markdownIt-Anchor" href="#3-sam-3d-模型部署-model-setup"></a> 3. SAM 3D 模型部署 (Model Setup)</h2>
<h3 id="31-安装-sam-3d-主体"><a class="markdownIt-Anchor" href="#31-安装-sam-3d-主体"></a> 3.1 安装 SAM 3D 主体</h3>
<p>采用 <strong>“无依赖安装模式”</strong>，防止 pip 自动降级我们已配置好的 PyTorch 和 Gsplat。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd ~/workspace/ai</span><br><span class="line">git clone https://github.com/facebookresearch/sam-3d-objects.git</span><br><span class="line">cd sam-3d-objects</span><br><span class="line"></span><br><span class="line"># 仅安装代码逻辑，不安装依赖</span><br><span class="line">pip install -e . --no-deps</span><br><span class="line"></span><br><span class="line"># 手动补齐纯 Python 依赖 (避开 Kaolin/PyTorch3D)</span><br><span class="line">pip install hydra-core omegaconf tqdm scikit-image opencv-python matplotlib nvidia-pyindex</span><br><span class="line">pip install git+https://github.com/microsoft/MoGe.git@a8c37341bc0325ca99b9d57981cc3bb2bd3e255b</span><br></pre></td></tr></table></figure>
<h3 id="32-下载模型权重-hugging-face"><a class="markdownIt-Anchor" href="#32-下载模型权重-hugging-face"></a> 3.2 下载模型权重 (Hugging Face)</h3>
<p>配置 Hugging Face 并下载完整权重。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 1. 登录 Hugging Face (需要 Access Token)</span><br><span class="line">pip install &quot;huggingface_hub[cli]&quot;</span><br><span class="line">huggingface-cli login </span><br><span class="line"></span><br><span class="line"># 2. 下载模型权重</span><br><span class="line">TAG=hf</span><br><span class="line">hf download --repo-type model --local-dir checkpoints/$&#123;TAG&#125;-download --max-workers 1 facebook/sam-3d-objects</span><br><span class="line">mv checkpoints/$&#123;TAG&#125;-download/checkpoints checkpoints/$&#123;TAG&#125;</span><br><span class="line">rm -rf checkpoints/$&#123;TAG&#125;-download</span><br><span class="line"></span><br><span class="line"># 3. 关键修复：补全缺失的配置文件 (官方权重包常缺失此文件)</span><br><span class="line">mkdir -p ./checkpoints/hf</span><br><span class="line">wget -O ./checkpoints/hf/ss_generator.yaml https://raw.githubusercontent.com/facebookresearch/sam-3d-objects/main/configs/ss_generator.yaml</span><br></pre></td></tr></table></figure>
<h2 id="4-技术创新全栈优化脚本-sam3dpy"><a class="markdownIt-Anchor" href="#4-技术创新全栈优化脚本-sam3dpy"></a> 4. 技术创新：全栈优化脚本 (<a target="_blank" rel="noopener" href="http://sam3d.py">sam3d.py</a>)</h2>
<p>这是本方案的核心技术创新点。我们编写一个单一的 Python 脚本 <a target="_blank" rel="noopener" href="http://sam3d.py">sam3d.py</a>，集成了以下技术：</p>
<ol>
<li><strong>Runtime Dependency Injection (Mocking)</strong>: 在内存中动态创建虚假的 kaolin 和 pytorch3d 模块，骗过 Python 的 import 检查，从而无需编译这些在 RTX 50 上难以构建的库。</li>
<li><strong>CPU-Offload Initialization</strong>: 拦截 torch.load，强制将所有模型权重加载到系统内存 (RAM)，防止初始化阶段 GPU OOM。</li>
<li><strong>Pipeline Hooking</strong>: 劫持推理管线函数，透传中间结果，强制关闭 Mesh 生成步骤（因其依赖 Kaolin），仅保留 Gaussian Splat 生成。</li>
</ol>
<p><strong>请将以下代码保存为 <a target="_blank" rel="noopener" href="http://sam3d.py">sam3d.py</a>，放在 Windows 的工程目录下：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> ModuleType</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># ================= 🔧 技术创新 1: 运行时依赖注入 (Mocking) =================</span></span><br><span class="line"><span class="comment"># 原理：SAM 3D 仅在数据加载和 Mesh 导出阶段依赖 Kaolin/PyTorch3D。</span></span><br><span class="line"><span class="comment"># 核心推理 (3DGS 生成) 仅依赖 gsplat。通过 Mock 骗过解释器，可免去复杂的编译过程。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inject_mocks</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;⚠️ [系统检测] 正在注入虚拟 Kaolin 和 PyTorch3D 运行时...&quot;</span>)</span><br><span class="line">    device = <span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 通用 Mock 类：吞噬所有调用，返回零张量或自身</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">MockClass</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>): <span class="variable language_">self</span>.device = device</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kwargs</span>): <span class="keyword">return</span> torch.zeros(<span class="number">1</span>, <span class="number">3</span>, device=device, requires_grad=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">compose</span>(<span class="params">self, *args, **kwargs</span>): <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">inverse</span>(<span class="params">self</span>): <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">to</span>(<span class="params">self, *args, **kwargs</span>): <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">cpu</span>(<span class="params">self</span>): <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">cuda</span>(<span class="params">self</span>): <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">clone</span>(<span class="params">self</span>): <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self</span>): <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get_matrix</span>(<span class="params">self</span>): <span class="keyword">return</span> torch.eye(<span class="number">4</span>, device=device).unsqueeze(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">transform_points</span>(<span class="params">self, x</span>): <span class="keyword">return</span> x </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">transform_normals</span>(<span class="params">self, x</span>): <span class="keyword">return</span> x</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__getattr__</span>(<span class="params">self, name</span>):</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">method_mock</span>(<span class="params">*args, **kwargs</span>): <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">            <span class="keyword">return</span> method_mock</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mock_func</span>(<span class="params">*args, **kwargs</span>): <span class="keyword">return</span> torch.tensor(<span class="number">0.0</span>, device=device)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. 伪造 Kaolin 模块树</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;kaolin&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> sys.modules:</span><br><span class="line">        mock_kaolin = ModuleType(<span class="string">&quot;kaolin&quot;</span>)</span><br><span class="line">        submodules = [<span class="string">&quot;ops&quot;</span>, <span class="string">&quot;ops.mesh&quot;</span>, <span class="string">&quot;ops.spc&quot;</span>, <span class="string">&quot;metrics&quot;</span>, <span class="string">&quot;metrics.pointcloud&quot;</span>, </span><br><span class="line">                      <span class="string">&quot;render&quot;</span>, <span class="string">&quot;render.camera&quot;</span>, <span class="string">&quot;render.mesh&quot;</span>, <span class="string">&quot;visualize&quot;</span>, <span class="string">&quot;io&quot;</span>, </span><br><span class="line">                      <span class="string">&quot;io.obj&quot;</span>, <span class="string">&quot;io.usd&quot;</span>, <span class="string">&quot;utils&quot;</span>, <span class="string">&quot;utils.testing&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> submodules:</span><br><span class="line">            parts = name.split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">            parent = mock_kaolin</span><br><span class="line">            <span class="keyword">for</span> i, part <span class="keyword">in</span> <span class="built_in">enumerate</span>(parts):</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(parent, part):</span><br><span class="line">                    new_mod = ModuleType(<span class="string">f&quot;kaolin.<span class="subst">&#123;<span class="string">&#x27;.&#x27;</span>.join(parts[:i+<span class="number">1</span>])&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">setattr</span>(parent, part, new_mod)</span><br><span class="line">                    sys.modules[<span class="string">f&quot;kaolin.<span class="subst">&#123;<span class="string">&#x27;.&#x27;</span>.join(parts[:i+<span class="number">1</span>])&#125;</span>&quot;</span>] = new_mod</span><br><span class="line">                parent = <span class="built_in">getattr</span>(parent, part)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 填充关键接口</span></span><br><span class="line">        mock_kaolin.ops.mesh.TriangleHash = MockClass</span><br><span class="line">        mock_kaolin.ops.mesh.check_sign = mock_func</span><br><span class="line">        mock_kaolin.ops.mesh.sample_points = mock_func</span><br><span class="line">        mock_kaolin.metrics.pointcloud.chamfer_distance = mock_func</span><br><span class="line">        mock_kaolin.visualize.IpyTurntableVisualizer = MockClass</span><br><span class="line">        mock_kaolin.render.camera.Camera = MockClass</span><br><span class="line">        mock_kaolin.render.camera.CameraExtrinsics = MockClass</span><br><span class="line">        mock_kaolin.render.camera.PinholeIntrinsics = MockClass</span><br><span class="line">        mock_kaolin.render.mesh.dibr_rasterization = mock_func</span><br><span class="line">        mock_kaolin.io.obj.import_mesh = <span class="keyword">lambda</span> *args, **kwargs: (<span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">        mock_kaolin.utils.testing.check_tensor = mock_func</span><br><span class="line">        mock_kaolin.__path__ = []</span><br><span class="line">        sys.modules[<span class="string">&quot;kaolin&quot;</span>] = mock_kaolin</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 伪造 PyTorch3D 模块树</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;pytorch3d&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> sys.modules:</span><br><span class="line">        mock_p3d = ModuleType(<span class="string">&quot;pytorch3d&quot;</span>)</span><br><span class="line">        mock_p3d.__path__ = []</span><br><span class="line">        <span class="keyword">for</span> mod <span class="keyword">in</span> [<span class="string">&quot;transforms&quot;</span>, <span class="string">&quot;structures&quot;</span>, <span class="string">&quot;renderer&quot;</span>, <span class="string">&quot;renderer.cameras&quot;</span>, <span class="string">&quot;renderer.camera_utils&quot;</span>, <span class="string">&quot;renderer.mesh&quot;</span>, <span class="string">&quot;vis&quot;</span>, <span class="string">&quot;vis.plotly_vis&quot;</span>]:</span><br><span class="line">            parts = mod.split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">            parent = mock_p3d</span><br><span class="line">            <span class="keyword">for</span> i, part <span class="keyword">in</span> <span class="built_in">enumerate</span>(parts):</span><br><span class="line">                <span class="keyword">if</span> i == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(parent, part):</span><br><span class="line">                    <span class="built_in">setattr</span>(parent, part, ModuleType(<span class="string">f&quot;pytorch3d.<span class="subst">&#123;<span class="string">&#x27;.&#x27;</span>.join(parts[:i+<span class="number">1</span>])&#125;</span>&quot;</span>))</span><br><span class="line">                parent = <span class="built_in">getattr</span>(parent, part)</span><br><span class="line">        </span><br><span class="line">        sys.modules[<span class="string">&quot;pytorch3d&quot;</span>] = mock_p3d</span><br><span class="line">        sys.modules[<span class="string">&quot;pytorch3d.transforms&quot;</span>] = mock_p3d.transforms</span><br><span class="line">        sys.modules[<span class="string">&quot;pytorch3d.structures&quot;</span>] = mock_p3d.structures</span><br><span class="line">        sys.modules[<span class="string">&quot;pytorch3d.renderer&quot;</span>] = mock_p3d.renderer</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 填充数学变换与渲染类</span></span><br><span class="line">        mock_p3d.transforms.Transform3d = MockClass</span><br><span class="line">        mock_p3d.transforms.Rotate = MockClass</span><br><span class="line">        mock_p3d.transforms.Translate = MockClass</span><br><span class="line">        mock_p3d.transforms.Scale = MockClass</span><br><span class="line">        mock_p3d.transforms.quaternion_multiply = <span class="keyword">lambda</span> q1, q2: q1 </span><br><span class="line">        mock_p3d.transforms.quaternion_invert = <span class="keyword">lambda</span> q: q</span><br><span class="line">        mock_p3d.transforms.matrix_to_quaternion = <span class="keyword">lambda</span> m: torch.tensor([<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>], device=m.device).repeat(m.shape[<span class="number">0</span>], <span class="number">1</span>)</span><br><span class="line">        mock_p3d.transforms.quaternion_to_matrix = <span class="keyword">lambda</span> q: torch.eye(<span class="number">3</span>, device=q.device).unsqueeze(<span class="number">0</span>).repeat(q.shape[<span class="number">0</span>], <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        mock_p3d.transforms.axis_angle_to_quaternion = <span class="keyword">lambda</span> a: torch.tensor([<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>], device=a.device).repeat(a.shape[<span class="number">0</span>], <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        mock_p3d.renderer.look_at_view_transform = <span class="keyword">lambda</span> **kwargs: (torch.eye(<span class="number">3</span>, device=device).unsqueeze(<span class="number">0</span>), torch.zeros(<span class="number">1</span>, <span class="number">3</span>, device=device))</span><br><span class="line">        mock_p3d.renderer.look_at_rotation = <span class="keyword">lambda</span> **kwargs: torch.eye(<span class="number">3</span>, device=device).unsqueeze(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        renderer_classes = [</span><br><span class="line">            <span class="string">&quot;FoVPerspectiveCameras&quot;</span>, <span class="string">&quot;PerspectiveCameras&quot;</span>, <span class="string">&quot;CamerasBase&quot;</span>,</span><br><span class="line">            <span class="string">&quot;PointsRenderer&quot;</span>, <span class="string">&quot;PointsRasterizationSettings&quot;</span>, <span class="string">&quot;PointsRasterizer&quot;</span>, </span><br><span class="line">            <span class="string">&quot;AlphaCompositor&quot;</span>, <span class="string">&quot;RasterizationSettings&quot;</span>, <span class="string">&quot;MeshRenderer&quot;</span>, <span class="string">&quot;MeshRasterizer&quot;</span>, </span><br><span class="line">            <span class="string">&quot;MeshRendererWithFragments&quot;</span>, <span class="string">&quot;SoftPhongShader&quot;</span>, <span class="string">&quot;HardPhongShader&quot;</span>, <span class="string">&quot;SoftSilhouetteShader&quot;</span>, </span><br><span class="line">            <span class="string">&quot;TexturesVertex&quot;</span>, <span class="string">&quot;PointLights&quot;</span>, <span class="string">&quot;DirectionalLights&quot;</span>, <span class="string">&quot;AmbientLights&quot;</span>, <span class="string">&quot;Materials&quot;</span>, <span class="string">&quot;BlendParams&quot;</span></span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">for</span> cls <span class="keyword">in</span> renderer_classes:</span><br><span class="line">            <span class="built_in">setattr</span>(mock_p3d.renderer, cls, MockClass)</span><br><span class="line"></span><br><span class="line">        mock_p3d.structures.Meshes = MockClass</span><br><span class="line">        mock_p3d.structures.Pointclouds = MockClass</span><br><span class="line">        mock_p3d.structures.join_meshes_as_batch = mock_func</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;✅ [虚拟化] 运行时依赖注入完成&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注入 Mocks</span></span><br><span class="line">inject_mocks()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ================= 🔧 配置区域 =================</span></span><br><span class="line">INPUT_IMAGE_NAME = <span class="string">&quot;input.jpg&quot;</span> </span><br><span class="line">LINUX_WORK_ROOT = Path.home() / <span class="string">&quot;sam3d_workspace&quot;</span></span><br><span class="line">SAM3D_REPO_PATH = Path.home() / <span class="string">&quot;workspace/ai/sam-3d-objects&quot;</span> <span class="comment"># 请根据实际路径修改</span></span><br><span class="line">CONFIG_PATH = SAM3D_REPO_PATH / <span class="string">&quot;checkpoints/hf/pipeline.yaml&quot;</span></span><br><span class="line"><span class="comment"># CPU 配置 Hack 路径</span></span><br><span class="line">CPU_CONFIG_PATH = CONFIG_PATH.parent / <span class="string">&quot;cpu_pipeline.yaml&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_duration</span>(<span class="params">seconds</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(datetime.timedelta(seconds=<span class="built_in">int</span>(seconds)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_environment</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> SAM3D_REPO_PATH.exists():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 错误: 找不到 SAM 3D 仓库路径: <span class="subst">&#123;SAM3D_REPO_PATH&#125;</span>&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    sys.path.append(<span class="built_in">str</span>(SAM3D_REPO_PATH))</span><br><span class="line">    sys.path.append(<span class="built_in">str</span>(SAM3D_REPO_PATH / <span class="string">&quot;notebook&quot;</span>))</span><br><span class="line">    os.chdir(SAM3D_REPO_PATH)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prepare_cpu_config</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建一个强制使用 CPU 的临时配置文件，防止 Inference 初始化时 GPU OOM&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> CONFIG_PATH.exists(): <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(CONFIG_PATH, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f: content = f.read()</span><br><span class="line">        new_content = content.replace(<span class="string">&quot;device: cuda&quot;</span>, <span class="string">&quot;device: cpu&quot;</span>).replace(<span class="string">&#x27;device: &quot;cuda&quot;&#x27;</span>, <span class="string">&#x27;device: &quot;cpu&quot;&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(CPU_CONFIG_PATH, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f: f.write(new_content)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">auto_generate_mask</span>(<span class="params">image_np</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;简单的亮度阈值自动去背景&quot;&quot;&quot;</span></span><br><span class="line">    intensity = image_np.mean(axis=<span class="number">2</span>)</span><br><span class="line">    is_white_bg = intensity &gt; <span class="number">240</span></span><br><span class="line">    is_black_bg = intensity &lt; <span class="number">15</span></span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">sum</span>(is_white_bg) &gt; image_np.size/<span class="number">3</span> * <span class="number">0.1</span>:</span><br><span class="line">        <span class="keyword">return</span> np.where(is_white_bg, <span class="number">0</span>, <span class="number">255</span>).astype(np.uint8)</span><br><span class="line">    <span class="keyword">elif</span> np.<span class="built_in">sum</span>(is_black_bg) &gt; image_np.size/<span class="number">3</span> * <span class="number">0.1</span>:</span><br><span class="line">        <span class="keyword">return</span> np.where(is_black_bg, <span class="number">0</span>, <span class="number">255</span>).astype(np.uint8)</span><br><span class="line">    <span class="keyword">return</span> np.ones(image_np.shape[:<span class="number">2</span>], dtype=np.uint8) * <span class="number">255</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_pipeline</span>():</span><br><span class="line">    global_start_time = time.time()</span><br><span class="line">    windows_dir = Path(__file__).resolve().parent</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 优先检测 PNG (Alpha 通道)</span></span><br><span class="line">    source_img_path = windows_dir / <span class="string">&quot;input.png&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> source_img_path.exists(): source_img_path = windows_dir / INPUT_IMAGE_NAME</span><br><span class="line">    </span><br><span class="line">    project_name = source_img_path.stem </span><br><span class="line">    work_dir = LINUX_WORK_ROOT / project_name</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n🚀 [RTX 5070 Pipeline] 启动任务: <span class="subst">&#123;source_img_path.name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> work_dir.exists(): shutil.rmtree(work_dir)</span><br><span class="line">    work_dir.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    target_img_path = work_dir / source_img_path.name</span><br><span class="line">    shutil.copy2(<span class="built_in">str</span>(source_img_path), <span class="built_in">str</span>(target_img_path))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n🧠 [2/3] 加载模型 (CPU初始化模式)...&quot;</span>)</span><br><span class="line">    setup_environment()</span><br><span class="line">    prepare_cpu_config()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">from</span> inference <span class="keyword">import</span> Inference, load_image</span><br><span class="line">        <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 技术创新 2: 拦截权重加载</span></span><br><span class="line">        <span class="comment"># 强制所有模型权重加载到系统内存 (RAM)，避免初始化时打爆显存</span></span><br><span class="line">        original_torch_load = torch.load</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">cpu_load_hook</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;map_location&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> kwargs: kwargs[<span class="string">&#x27;map_location&#x27;</span>] = <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> original_torch_load(*args, **kwargs)</span><br><span class="line">        </span><br><span class="line">        torch.load = cpu_load_hook</span><br><span class="line">        inference = Inference(<span class="built_in">str</span>(CPU_CONFIG_PATH))</span><br><span class="line">        inference._pipeline.device = torch.device(<span class="string">&#x27;cuda&#x27;</span>) <span class="comment"># 欺骗 Pipeline 对象</span></span><br><span class="line">        torch.load = original_torch_load <span class="comment"># 恢复钩子</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;    ✅ 模型加载完成 (RAM驻留)&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2. 图像预处理</span></span><br><span class="line">        pil_image = Image.<span class="built_in">open</span>(<span class="built_in">str</span>(target_img_path)).convert(<span class="string">&quot;RGBA&quot;</span>)</span><br><span class="line">        <span class="comment"># 降采样保护显存</span></span><br><span class="line">        target_size = <span class="number">256</span> </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">max</span>(pil_image.size) &gt; target_size:</span><br><span class="line">            scale = target_size / <span class="built_in">max</span>(pil_image.size)</span><br><span class="line">            pil_image = pil_image.resize((<span class="built_in">int</span>(pil_image.size[<span class="number">0</span>]*scale), <span class="built_in">int</span>(pil_image.size[<span class="number">1</span>]*scale)), Image.LANCZOS)</span><br><span class="line">        </span><br><span class="line">        image_rgba = np.array(pil_image)</span><br><span class="line">        image = image_rgba[:, :, :<span class="number">3</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Mask 处理：优先 Alpha，否则自动计算</span></span><br><span class="line">        <span class="keyword">if</span> image_rgba.shape[<span class="number">2</span>] == <span class="number">4</span>: mask = image_rgba[:, :, <span class="number">3</span>]</span><br><span class="line">        <span class="keyword">else</span>: mask = auto_generate_mask(image)</span><br><span class="line"></span><br><span class="line">        pipeline = inference._pipeline</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3. 技术创新 3: 显存分级流水线 (Manual Memory Pipeline)</span></span><br><span class="line">        <span class="comment"># 12GB 显存无法同时容纳 Stage1 + Stage2 + DINO，必须手动调度</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># --- Stage 1: Sparse Structure ---</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n🚚 [Stage 1] 搬运模型至 GPU...&quot;</span>)</span><br><span class="line">        pipeline.models[<span class="string">&quot;ss_generator&quot;</span>].to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">        pipeline.models[<span class="string">&quot;ss_decoder&quot;</span>].to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ss_encoder&quot;</span> <span class="keyword">in</span> pipeline.models <span class="keyword">and</span> pipeline.models[<span class="string">&quot;ss_encoder&quot;</span>]: pipeline.models[<span class="string">&quot;ss_encoder&quot;</span>].to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ss_condition_embedder&quot;</span> <span class="keyword">in</span> pipeline.condition_embedders: pipeline.condition_embedders[<span class="string">&quot;ss_condition_embedder&quot;</span>].to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;🚀 [Stage 1] 生成稀疏结构...&quot;</span>)</span><br><span class="line">        stage1_output = pipeline.run(image=image, mask=mask, stage1_only=<span class="literal">True</span>, seed=<span class="number">42</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># --- Stage Switch ---</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n🔄 [显存切换] 卸载 Stage 1 -&gt; 加载 Stage 2...&quot;</span>)</span><br><span class="line">        pipeline.models[<span class="string">&quot;ss_generator&quot;</span>].cpu()</span><br><span class="line">        pipeline.models[<span class="string">&quot;ss_decoder&quot;</span>].cpu()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ss_encoder&quot;</span> <span class="keyword">in</span> pipeline.models <span class="keyword">and</span> pipeline.models[<span class="string">&quot;ss_encoder&quot;</span>]: pipeline.models[<span class="string">&quot;ss_encoder&quot;</span>].cpu()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ss_condition_embedder&quot;</span> <span class="keyword">in</span> pipeline.condition_embedders: pipeline.condition_embedders[<span class="string">&quot;ss_condition_embedder&quot;</span>].cpu()</span><br><span class="line">        torch.cuda.empty_cache()</span><br><span class="line"></span><br><span class="line">        pipeline.models[<span class="string">&quot;slat_generator&quot;</span>].to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">        pipeline.models[<span class="string">&quot;slat_decoder_gs&quot;</span>].to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;slat_condition_embedder&quot;</span> <span class="keyword">in</span> pipeline.condition_embedders: pipeline.condition_embedders[<span class="string">&quot;slat_condition_embedder&quot;</span>].to(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. 技术创新 4: 禁用 Mesh Decoder (绕过 Kaolin 依赖)</span></span><br><span class="line">        pipeline.decode_formats = [<span class="string">&quot;gaussian&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># --- Stage 2: Gaussian Generation ---</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;🚀 [Stage 2] 生成 Gaussian Splats...&quot;</span>)</span><br><span class="line">        <span class="comment"># Hook: 劫持 sample_sparse_structure，直接注入 Stage 1 结果，避免重复计算</span></span><br><span class="line">        original_sample_ss = pipeline.sample_sparse_structure</span><br><span class="line">        pipeline.sample_sparse_structure = <span class="keyword">lambda</span> *args, **kwargs: stage1_output</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            output = pipeline.run(image=image, mask=mask, stage1_only=<span class="literal">False</span>, seed=<span class="number">42</span>, </span><br><span class="line">                                  with_mesh_postprocess=<span class="literal">False</span>, with_texture_baking=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            pipeline.sample_sparse_structure = original_sample_ss</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 5. 结果保存</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;gs&quot;</span> <span class="keyword">in</span> output:</span><br><span class="line">            ply_output_path = work_dir / <span class="string">f&quot;<span class="subst">&#123;project_name&#125;</span>_3d.ply&quot;</span></span><br><span class="line">            output[<span class="string">&quot;gs&quot;</span>].save_ply(<span class="built_in">str</span>(ply_output_path))</span><br><span class="line">            final_windows_path = windows_dir / <span class="string">f&quot;<span class="subst">&#123;project_name&#125;</span>_3dgs.ply&quot;</span></span><br><span class="line">            shutil.copy2(<span class="built_in">str</span>(ply_output_path), <span class="built_in">str</span>(final_windows_path))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n🎉 成功！模型已保存: <span class="subst">&#123;final_windows_path&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;❌ 失败: 未生成数据&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 运行出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">import</span> traceback</span><br><span class="line">        traceback.print_exc()</span><br><span class="line">        torch.cuda.empty_cache()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n📊 总耗时: <span class="subst">&#123;format_duration(time.time() - global_start_time)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    run_pipeline()</span><br></pre></td></tr></table></figure>
<h2 id="5-运行与结果验证"><a class="markdownIt-Anchor" href="#5-运行与结果验证"></a> 5. 运行与结果验证</h2>
<h3 id="51-启动推理"><a class="markdownIt-Anchor" href="#51-启动推理"></a> 5.1 启动推理</h3>
<p>在 WSL 终端中，导航到 Windows 下脚本所在目录并运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /mnt/c/Users/&lt;YourName&gt;/.../SAM3d</span><br><span class="line"># CUDA_LAUNCH_BLOCKING=1 有助于防止 Windows TDR 超时</span><br><span class="line">CUDA_LAUNCH_BLOCKING=1 python sam3d.py</span><br></pre></td></tr></table></figure>
<h3 id="52-预期输出"><a class="markdownIt-Anchor" href="#52-预期输出"></a> 5.2 预期输出</h3>
<ol>
<li><strong>Mock 注入成功</strong>：看到 ✅ [虚拟化] 运行时依赖注入完成。</li>
<li><strong>显存优化</strong>：初始化时显存占用极低，Stage 切换时显存会有明显释放和重新占用。</li>
<li><strong>结果生成</strong>：在当前目录下生成 input_3dgs.ply 文件。</li>
</ol>
<h1 id="在-rtx-5070-wsl-环境下强行跑通-sam-3d一场跨越软硬件代沟的踩坑实录"><a class="markdownIt-Anchor" href="#在-rtx-5070-wsl-环境下强行跑通-sam-3d一场跨越软硬件代沟的踩坑实录"></a> 在 RTX 5070 + WSL 环境下强行跑通 SAM 3D：一场跨越软硬件代沟的踩坑实录</h1>
<p><strong>背景</strong>：Meta 开源的 SAM 3D Objects 是一个极其惊艳的“单图转3D”模型。然而，当它遇到 2025 年发布的 NVIDIA RTX 5070 (Blackwell 架构) 时，发生了一场灾难性的化学反应。显卡太新，库太老，依赖冲突，CUDA 兼容性… 这是一个关于如何在一个不支持的环境中，通过“欺骗”、“魔改”和“移花接木”最终跑通代码的故事。</p>
<p><strong>环境配置</strong>：</p>
<ul>
<li><strong>OS</strong>: Windows 11 + WSL2 (Ubuntu)</li>
<li><strong>GPU</strong>: NVIDIA GeForce RTX 5070 (Compute Capability sm_120)</li>
<li><strong>Goal</strong>: 运行 facebookresearch/sam-3d-objects 推理 Pipeline</li>
<li><strong>核心矛盾</strong>: 项目依赖 PyTorch 2.5.1 (CUDA 12.1)，但 RTX 5070 必须使用 PyTorch Nightly 2.9.1+ (CUDA 12.8+) 才能识别。</li>
</ul>
<h2 id="第一阶段依赖缺失与伪造战术-the-mocking-game"><a class="markdownIt-Anchor" href="#第一阶段依赖缺失与伪造战术-the-mocking-game"></a> 第一阶段：依赖缺失与“伪造”战术 (The Mocking Game)</h2>
<p>项目初始依赖安装中，kaolin 和 pytorch3d 是两个最大的拦路虎。由于环境复杂，直接编译失败。为了快速验证逻辑，我选择了 <strong>Mock（伪造）</strong> 策略。</p>
<h3 id="坑-1pytorch3d-模块缺失与-visualization-报错"><a class="markdownIt-Anchor" href="#坑-1pytorch3d-模块缺失与-visualization-报错"></a> 坑 1：PyTorch3D 模块缺失与 Visualization 报错</h3>
<p><strong>现象</strong>：运行脚本直接报错 ImportError，提示找不到 pytorch3d 或 kaolin 的子模块。 <strong>分析</strong>：SAM 3D 的推理代码 (<a target="_blank" rel="noopener" href="http://inference.py">inference.py</a>) 引用了大量的辅助工具类（如相机变换、可视化器），但这些库在 Windows/WSL 混合环境下极难编译。 <strong>措施</strong>： 不编译库，直接在 <a target="_blank" rel="noopener" href="http://sam3d.py">sam3d.py</a> 脚本头部注入 Mock 对象。</p>
<ul>
<li>伪造了 kaolin.visualize.IpyTurntableVisualizer。</li>
<li>伪造了 pytorch3d.vis.plotly_vis 及其辅助函数 _scale_camera_to_bounds, _update_axes_bounds。</li>
<li><strong>核心逻辑</strong>：只要推理核心不调用这些可视化函数，空壳类就能骗过 Python 的 Import 检查。</li>
</ul>
<h3 id="坑-2transform3d-的链式调用陷阱"><a class="markdownIt-Anchor" href="#坑-2transform3d-的链式调用陷阱"></a> 坑 2：Transform3d 的链式调用陷阱</h3>
<p><strong>现象</strong>：Mock 了 Transform3d 类，但报错 ‘Tensor’ object has no attribute ‘rotate’。 <strong>分析</strong>：PyTorch3D 的变换类支持链式调用（如 t.rotate().translate()）。简单的 Mock 函数返回了 Tensor，导致链条断裂。 <strong>措施</strong>： 重写 Mock 类，使其在调用方法（如 compose, inverse）时返回 self，仅在 <strong>call</strong> 时返回 Tensor。</p>
<h2 id="第二阶段数据流与类型的严苛校验"><a class="markdownIt-Anchor" href="#第二阶段数据流与类型的严苛校验"></a> 第二阶段：数据流与类型的严苛校验</h2>
<p>解决了 Import 问题后，数据喂进去了，但格式全是错。</p>
<h3 id="坑-3mask-的数值溢出"><a class="markdownIt-Anchor" href="#坑-3mask-的数值溢出"></a> 坑 3：Mask 的数值溢出</h3>
<p><strong>现象</strong>：RuntimeError: max(): Expected reduction dim … input.numel() == 0。 <strong>分析</strong>：</p>
<ul>
<li>我手动创建了 Mask：mask = np.ones(…) * 255。</li>
<li><a target="_blank" rel="noopener" href="http://inference.py">inference.py</a> 内部逻辑有一行 mask = mask.astype(np.uint8) * 255。</li>
<li><strong>灾难</strong>：255 (uint8) * 255 发生了整数溢出，变成了 1。也就是几乎全透明，导致点云被过滤光了。 <strong>措施</strong>：修改 Mask 初始化逻辑，直接传入 255 并确保 pipeline 内部不再重复缩放，或者传入 1 让其缩放（最终方案是直接对接底层 run()，故需传入 255）。</li>
</ul>
<h3 id="坑-4维度与类型断言-assertionerror"><a class="markdownIt-Anchor" href="#坑-4维度与类型断言-assertionerror"></a> 坑 4：维度与类型断言 (AssertionError)</h3>
<p><strong>现象</strong>：</p>
<ol>
<li>ValueError: 拼接图像时维度不匹配 (3D vs 4D)。</li>
<li>AssertionError: assert image.dtype == np.uint8。 <strong>分析</strong>：</li>
</ol>
<ul>
<li>SAM 3D 的 Pipeline 对输入非常挑剔。它会自动给 Mask 增加 Batch 维度。如果我们预处理时手动加了维度，就会导致维度过多。</li>
<li>习惯性地将图像归一化到 [0, 1] (Float)，但模型强行要求 [0, 255] (Uint8)。 <strong>措施</strong>：</li>
<li><strong>去归一化</strong>：保持输入为 uint8。</li>
<li><strong>维度回退</strong>：保持 Mask 为 2D (H, W)，让 Pipeline 自己去处理升维。</li>
</ul>
<h2 id="第三阶段显存危机-oom-与-5070-的架构墙"><a class="markdownIt-Anchor" href="#第三阶段显存危机-oom-与-5070-的架构墙"></a> 第三阶段：显存危机 (OOM) 与 5070 的架构墙</h2>
<p>这是最绝望的阶段。代码通了，但硬件撑不住，或者硬件不兼容。</p>
<h3 id="坑-512gb-显存的极限与贪婪加载"><a class="markdownIt-Anchor" href="#坑-512gb-显存的极限与贪婪加载"></a> 坑 5：12GB 显存的极限与贪婪加载</h3>
<p><strong>现象</strong>：CUDA error: out of memory。 <strong>分析</strong>：RTX 5070 只有 12GB 显存。InferencePipeline 初始化时极其“贪婪”，试图一次性把 Stage 1 (Sparse Structure) 和 Stage 2 (Latent -&gt; Gaussian) 的所有模型（包括巨大的 DINOv2）全部加载进显存。初始化阶段就爆了。 <strong>措施：分阶段加载 (Stage-wise Loading)</strong>。 重写 run_pipeline 逻辑：</p>
<ol>
<li><strong>CPU 初始化</strong>：通过 Hack 配置文件，强制模型初始化在 CPU 内存中。</li>
<li><strong>Stage 1</strong>：只把 Stage 1 相关的模型搬运到 GPU，跑完后立即卸载回 CPU。</li>
<li><strong>Stage 2</strong>：搬运 Stage 2 模型到 GPU，执行后续。 这让 12GB 显存也能跑动大模型。</li>
</ol>
<h3 id="坑-6blackwell-架构-sm_120-的排斥反应"><a class="markdownIt-Anchor" href="#坑-6blackwell-架构-sm_120-的排斥反应"></a> 坑 6：Blackwell 架构 (sm_120) 的排斥反应</h3>
<p><strong>现象</strong>：RuntimeError: CUDA error: no kernel image is available for execution on the device。 <strong>分析</strong>：</p>
<ul>
<li>项目默认依赖 PyTorch 2.5.1 (CUDA 12.1)，最高支持 sm_90 (Hopper)。</li>
<li>RTX 5070 是 sm_120。旧版 PyTorch 根本没有包含能在这张卡上运行的二进制代码。 <strong>尝试</strong>：试图设置 TORCH_CUDA_ARCH_LIST=“9.0” 进行 JIT 编译，失败。 <strong>结论</strong>：<strong>必须使用 PyTorch Nightly (2.9.1+)</strong>。</li>
</ul>
<h2 id="第四阶段编译地狱-nightly-build-vs-legacy-code"><a class="markdownIt-Anchor" href="#第四阶段编译地狱-nightly-build-vs-legacy-code"></a> 第四阶段：编译地狱 (Nightly Build vs Legacy Code)</h2>
<p>为了迁就显卡换了 PyTorch Nightly，结果引发了依赖库的全面崩盘。</p>
<h3 id="坑-7kaolin-与-pytorch3d-的-c-abi-冲突"><a class="markdownIt-Anchor" href="#坑-7kaolin-与-pytorch3d-的-c-abi-冲突"></a> 坑 7：Kaolin 与 PyTorch3D 的 C++ ABI 冲突</h3>
<p><strong>现象</strong>：换了 PyTorch 2.9.1 后，kaolin 报错 undefined symbol 或 ImportError: Kaolin requires PyTorch &lt;= 2.5.1。 <strong>分析</strong>：</p>
<ul>
<li><strong>预编译包失效</strong>：官方 Wheel 包是针对旧 PyTorch 编译的，ABI 不兼容。</li>
<li><strong>源码编译失败</strong>：Kaolin 源码中包含过时的 CUDA API (cudaMemcpyToArray 等)，被 CUDA 12.8 的编译器拒绝。 <strong>尝试</strong>：</li>
<li>修改 <a target="_blank" rel="noopener" href="http://setup.py">setup.py</a> 解除版本限制 -&gt; 失败（C++ 编译错误）。</li>
<li>降级 GCC -&gt; 失败。</li>
<li>寻找 Nvidia Nightly Index -&gt; 下载了针对 PyTorch 2.5 的包，依然 ABI 冲突。</li>
</ul>
<h3 id="坑-8gsplat-的死循环"><a class="markdownIt-Anchor" href="#坑-8gsplat-的死循环"></a> 坑 8：Gsplat 的死循环</h3>
<p><strong>现象</strong>：pip install 自动触发 gsplat 编译，但因为 build isolation 找不到 torch 而失败。 <strong>措施</strong>：</p>
<ol>
<li>手动克隆 gsplat 源码。</li>
<li>使用 pip install . --no-build-isolation 强制使用当前环境的 Nightly PyTorch 进行编译。 <strong>结果</strong>：这是唯一成功的编译！Gsplat 成功适配了 RTX 5070。</li>
</ol>
<h2 id="第五阶段终局之战-the-hybrid-solution"><a class="markdownIt-Anchor" href="#第五阶段终局之战-the-hybrid-solution"></a> 第五阶段：终局之战 (The Hybrid Solution)</h2>
<p>既然 Kaolin 和 PyTorch3D 无论如何都无法在 RTX 5070 + PyTorch Nightly 上编译成功，而核心推理库 Gsplat 却编译成功了，我们采用了一个大胆的 <strong>“半真半假”</strong> 策略。</p>
<h3 id="最终解决方案真-gsplat-假辅助库"><a class="markdownIt-Anchor" href="#最终解决方案真-gsplat-假辅助库"></a> 最终解决方案：真 Gsplat + 假辅助库</h3>
<p><strong>思路</strong>：SAM 3D 的核心生成逻辑依赖 Gsplat，而 Kaolin 和 PyTorch3D 更多用于数据加载、网格生成（Mesh）和可视化。既然我们要的是 Gaussian Splat (.ply)，我们可以<strong>放弃 Mesh 生成</strong>，从而<strong>不需要</strong>这两个库的 C++ 核心功能。</p>
<p><strong>操作步骤</strong>：</p>
<ol>
<li><strong>环境基石</strong>：使用成功编译了 Gsplat 的 gs_linux 环境 (Torch 2.9.1 Nightly)。</li>
<li><strong>全面伪造 (Mock V13)</strong>：
<ul>
<li>在 <a target="_blank" rel="noopener" href="http://sam3d.py">sam3d.py</a> 头部注入大量 Mock 代码，伪造 kaolin 的 TriangleHash、check_tensor 以及 pytorch3d 的 RasterizationSettings、BlendParams 等。</li>
<li>甚至伪造了数学函数 quaternion_multiply（反正推理阶段可能用不到，或者用不到高精度）。</li>
</ul>
</li>
<li><strong>Hook (移花接木)</strong>：
<ul>
<li>为了防止 Pipeline 内部调用真实的 Mesh 生成逻辑，我们在 Stage 2 之前设置 pipeline.decode_formats = [“gaussian”]。</li>
<li>通过 Hook sample_sparse_structure 函数，将 Stage 1 的结果直接透传给 Stage 2，避免重复计算和显存爆炸。</li>
</ul>
</li>
<li><strong>去背景</strong>：
<ul>
<li>输入图片如果是 JPG，全白 Mask 会导致生成一个实心长方体（把背景也算进去了）。</li>
<li><strong>最终解</strong>：使用 <a target="_blank" rel="noopener" href="http://remove.bg">remove.bg</a> 生成透明 PNG，利用 Alpha 通道作为 Mask。</li>
</ul>
</li>
</ol>
<h3 id="结果"><a class="markdownIt-Anchor" href="#结果"></a> 结果</h3>
<ul>
<li><strong>Kaolin</strong>: Mocked (未安装)</li>
<li><strong>PyTorch3D</strong>: Mocked (未安装)</li>
<li><strong>Gsplat</strong>: Real (本地编译, CUDA 12.8)</li>
<li><strong>PyTorch</strong>: Nightly 2.9.1</li>
<li><strong>Output</strong>: 成功生成 .ply 文件，在 Super Splat 中完美查看。</li>
</ul>
<h3 id="总结-takeaway"><a class="markdownIt-Anchor" href="#总结-takeaway"></a> 总结 (Takeaway)</h3>
<p>在 RTX 50 系这种超前硬件上运行旧代码，核心心法只有两条：</p>
<ol>
<li><strong>核心算子必须真</strong>：涉及到 GPU 核心计算的（如 gsplat 的光栅化），必须基于 Nightly PyTorch 重新编译，绝无捷径。</li>
<li><strong>辅助组件可以假</strong>：对于只负责 I/O、格式转换或非核心渲染的重型库（如 Kaolin），如果编译不过，<strong>Mock 往往比 Debug C++ 源码更高效</strong>。</li>
</ol>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://github.com/tianxingleo.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://github.com/tianxingleo.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">Tianxingleo</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://tianxingleo.top/2025/12/08/%E3%80%90%E9%A6%96%E5%8F%91%E3%80%91%E5%9C%A8-RTX-5070-Blackwell-WSL2-%E4%B8%8A%E8%B7%91%E9%80%9A%E6%9C%80%E6%96%B0%E6%A8%A1%E5%9E%8B-Meta-SAM-3D-%E7%9A%84%E7%BB%88%E6%9E%81%E6%96%B9%E6%A1%88/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://tianxingleo.top/2025/12/08/%E3%80%90%E9%A6%96%E5%8F%91%E3%80%91%E5%9C%A8-RTX-5070-Blackwell-WSL2-%E4%B8%8A%E8%B7%91%E9%80%9A%E6%9C%80%E6%96%B0%E6%A8%A1%E5%9E%8B-Meta-SAM-3D-%E7%9A%84%E7%BB%88%E6%9E%81%E6%96%B9%E6%A1%88/')">【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://tianxingleo.top/2025/12/08/%E3%80%90%E9%A6%96%E5%8F%91%E3%80%91%E5%9C%A8-RTX-5070-Blackwell-WSL2-%E4%B8%8A%E8%B7%91%E9%80%9A%E6%9C%80%E6%96%B0%E6%A8%A1%E5%9E%8B-Meta-SAM-3D-%E7%9A%84%E7%BB%88%E6%9E%81%E6%96%B9%E6%A1%88/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=【首发】在 RTX 5070 (Blackwell) + WSL2 上跑通最新模型 Meta SAM 3D 的终极方案&amp;url=http://tianxingleo.top/2025/12/08/%E3%80%90%E9%A6%96%E5%8F%91%E3%80%91%E5%9C%A8-RTX-5070-Blackwell-WSL2-%E4%B8%8A%E8%B7%91%E9%80%9A%E6%9C%80%E6%96%B0%E6%A8%A1%E5%9E%8B-Meta-SAM-3D-%E7%9A%84%E7%BB%88%E6%9E%81%E6%96%B9%E6%A1%88/&amp;pic=https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/114477837_p0_master1200.webp?_r_=585ff05b-6057-357e-76d9-daf6077fda93" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://tianxingleo.top" target="_blank">Tianxingleo的Blog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/3dgs/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>3dgs<span class="tagsPageCount">7</span></a><a class="post-meta__box__tags" href="/tags/5070/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>5070<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/blackwell/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>blackwell<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/wsl/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>wsl<span class="tagsPageCount">5</span></a><a class="post-meta__box__tags" href="/tags/pytorch/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>pytorch<span class="tagsPageCount">3</span></a><a class="post-meta__box__tags" href="/tags/cuda/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>cuda<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/SAM3D/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>SAM3D<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>linux<span class="tagsPageCount">5</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/8eb85bb13982d5a8187fee8a42adf1bc1a95a704.webp?_r_=b6c79946-9f9b-14a9-768d-4e3fe90e1c6c" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/12/07/%E5%9C%A8-Linux-WSL-RTX-50-%E7%B3%BB%E5%88%97%E6%98%BE%E5%8D%A1%E4%B8%8A%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%94%9F-GPU-%E5%8A%A0%E9%80%9F-COLMAP-%E7%9A%84%E6%8C%87%E5%8D%97/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/7ae2047cde0451cf21fa7a8842565b58f0e9d1e1.webp?_r_=d605855f-5171-9052-d931-5afa2817ede8" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">在 Linux (WSL) + RTX 50 系列显卡上部署原生 GPU 加速 COLMAP 的指南</div></div></a></div><div class="next-post pull-right"><a href="/2025/12/10/%E5%9C%A8%E6%9C%80%E6%96%B0Blackwell%E6%9E%B6%E6%9E%84%E4%BD%8E%E6%98%BE%E5%AD%98%E6%B6%88%E8%B4%B9%E7%BA%A7%E6%98%BE%E5%8D%A1%E4%B8%8A%E9%80%9A%E8%BF%87%E5%A4%8D%E7%8E%B0%E6%9C%80%E6%96%B0%E8%AE%BA%E6%96%87%E4%BD%BF%E7%94%A8VGGT%E6%9B%BF%E4%BB%A3COLMAP%E5%8A%A0%E9%80%9F3DGS%E8%AE%AD%E7%BB%83/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/114477837_p0_master1200.webp?_r_=0fd06ba4-63e4-e8a9-1e6f-dc5632d9d8e7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">在最新Blackwell架构低显存消费级显卡上通过复现最新论文使用VGGT替代COLMAP加速3DGS训练</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/12/10/%E5%9C%A8%E6%9C%80%E6%96%B0Blackwell%E6%9E%B6%E6%9E%84%E4%BD%8E%E6%98%BE%E5%AD%98%E6%B6%88%E8%B4%B9%E7%BA%A7%E6%98%BE%E5%8D%A1%E4%B8%8A%E9%80%9A%E8%BF%87%E5%A4%8D%E7%8E%B0%E6%9C%80%E6%96%B0%E8%AE%BA%E6%96%87%E4%BD%BF%E7%94%A8VGGT%E6%9B%BF%E4%BB%A3COLMAP%E5%8A%A0%E9%80%9F3DGS%E8%AE%AD%E7%BB%83/" title="在最新Blackwell架构低显存消费级显卡上通过复现最新论文使用VGGT替代COLMAP加速3DGS训练"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/114477837_p0_master1200.webp?_r_=0fd06ba4-63e4-e8a9-1e6f-dc5632d9d8e7" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-10</div><div class="title">在最新Blackwell架构低显存消费级显卡上通过复现最新论文使用VGGT替代COLMAP加速3DGS训练</div></div></a></div><div><a href="/2025/12/05/%E3%80%90%E9%A6%96%E5%8F%91%E3%80%91%E9%92%88%E5%AF%B9-Windows-%E7%8E%AF%E5%A2%83%E4%B8%8B-NVIDIA-RTX-50-%E7%B3%BB%E5%88%97%E5%9B%BE%E5%BD%A2%E5%A4%84%E7%90%86%E5%8D%95%E5%85%83%E7%9A%84-Nerfstudio-3DGS-%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B/" title="【首发】针对 Windows 环境下 NVIDIA RTX 50 系列图形处理单元的 Nerfstudio (3DGS) 部署流程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/%E3%80%90Pixiv%E7%94%BB%E5%B8%88%E7%B2%BE%E9%80%89%EF%BC%88132%EF%BC%89%E3%80%91%E5%85%AB%E4%B8%89_988777.webp?_r_=be19c9fb-4e4e-cafd-4d5c-ff8275c60cdc" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-05</div><div class="title">【首发】针对 Windows 环境下 NVIDIA RTX 50 系列图形处理单元的 Nerfstudio (3DGS) 部署流程</div></div></a></div><div><a href="/2025/12/07/%E5%9C%A8-Linux-WSL-RTX-50-%E7%B3%BB%E5%88%97%E6%98%BE%E5%8D%A1%E4%B8%8A%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%94%9F-GPU-%E5%8A%A0%E9%80%9F-COLMAP-%E7%9A%84%E6%8C%87%E5%8D%97/" title="在 Linux (WSL) + RTX 50 系列显卡上部署原生 GPU 加速 COLMAP 的指南"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/7ae2047cde0451cf21fa7a8842565b58f0e9d1e1.webp?_r_=d605855f-5171-9052-d931-5afa2817ede8" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-07</div><div class="title">在 Linux (WSL) + RTX 50 系列显卡上部署原生 GPU 加速 COLMAP 的指南</div></div></a></div><div><a href="/2025/12/10/%E7%94%A8-GLOMAP-%E6%9B%BF%E6%8D%A2-COLMAP-%E5%8A%A0%E9%80%9F-3DGS-%E9%87%8D%E5%BB%BA%E7%AE%A1%E7%BA%BF/" title="用 GLOMAP 替换 COLMAP 加速 3DGS 重建管线"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/91953835_p0.webp?_r_=a52895f4-935c-fd0a-f570-b4b93ca3cb2c" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-10</div><div class="title">用 GLOMAP 替换 COLMAP 加速 3DGS 重建管线</div></div></a></div><div><a href="/2025/12/10/3DGS-%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%A6%82%E4%BD%95%E5%BD%BB%E5%BA%95%E6%B6%88%E9%99%A4%E4%BC%AA%E5%BD%B1%E4%B8%8E%E8%83%8C%E6%99%AF%E6%BC%82%E6%B5%AE%E7%89%A9%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8E-Nerfstudio-%E7%9A%84%E5%AF%B9%E8%B1%A1%E7%BA%A7%E9%87%8D%E5%BB%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" title="3DGS：利用YOLO+SAM+Mask彻底消除伪影与背景漂浮物——基于 Nerfstudio 的对象级重建最佳实践"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/7ae2047cde0451cf21fa7a8842565b58f0e9d1e1.webp?_r_=074f271f-a008-8269-6f1d-3594eeea6ee4" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-10</div><div class="title">3DGS：利用YOLO+SAM+Mask彻底消除伪影与背景漂浮物——基于 Nerfstudio 的对象级重建最佳实践</div></div></a></div><div><a href="/2025/12/05/%E5%85%B3%E4%BA%8E%E5%9C%A8-Google-Colab-%E5%B9%B3%E5%8F%B0%E5%9F%BA%E4%BA%8E-Tesla-T4-%E5%8A%A0%E9%80%9F%E5%99%A8%E5%85%A8%E6%B5%81%E7%A8%8B%E9%83%A8%E7%BD%B2%E4%B8%89%E7%BB%B4%E9%AB%98%E6%96%AF%E6%B3%BC%E6%BA%85%EF%BC%883DGS%EF%BC%89%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AE%9E%E6%96%BD%E5%8D%8F%E8%AE%AE%EF%BC%882025-12%EF%BC%89/" title="关于在 Google Colab 平台基于 Tesla T4 加速器全流程部署三维高斯泼溅（3DGS）技术的实施协议（2025.12）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/8eb85bb13982d5a8187fee8a42adf1bc1a95a704.webp?_r_=97eac4cf-cd1d-2e2e-1d54-e8d0e7556a69" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-12-05</div><div class="title">关于在 Google Colab 平台基于 Tesla T4 加速器全流程部署三维高斯泼溅（3DGS）技术的实施协议（2025.12）</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://github.com/tianxingleo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);"><b style="color:#fff">这是天马行空（tianxingleo）</b>的blog，用于<b style="color:#fff">记录、分享、学习、交流</b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Tianxingleo</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="/atom.xml" target="_blank" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%83%8C%E6%99%AF%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98"><span class="toc-number">1.</span> <span class="toc-text"> 1. 背景与技术挑战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA-infrastructure"><span class="toc-number">2.</span> <span class="toc-text"> 2. 基础环境构建 (Infrastructure)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-wsl2-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.1.</span> <span class="toc-text"> 2.1 WSL2 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E5%AE%89%E8%A3%85-pytorch-%E7%A8%B3%E5%AE%9A%E7%89%88-cuda-128"><span class="toc-number">2.2.</span> <span class="toc-text"> 2.2 安装 PyTorch (稳定版 CUDA 12.8)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%E7%BC%96%E8%AF%91%E6%A0%B8%E5%BF%83%E5%85%89%E6%A0%85%E5%8C%96%E5%BC%95%E6%93%8Egsplat"><span class="toc-number">2.3.</span> <span class="toc-text"> 2.3 编译核心光栅化引擎：Gsplat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-sam-3d-%E6%A8%A1%E5%9E%8B%E9%83%A8%E7%BD%B2-model-setup"><span class="toc-number">3.</span> <span class="toc-text"> 3. SAM 3D 模型部署 (Model Setup)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E5%AE%89%E8%A3%85-sam-3d-%E4%B8%BB%E4%BD%93"><span class="toc-number">3.1.</span> <span class="toc-text"> 3.1 安装 SAM 3D 主体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B%E6%9D%83%E9%87%8D-hugging-face"><span class="toc-number">3.2.</span> <span class="toc-text"> 3.2 下载模型权重 (Hugging Face)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%8A%80%E6%9C%AF%E5%88%9B%E6%96%B0%E5%85%A8%E6%A0%88%E4%BC%98%E5%8C%96%E8%84%9A%E6%9C%AC-sam3dpy"><span class="toc-number">4.</span> <span class="toc-text"> 4. 技术创新：全栈优化脚本 (sam3d.py)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E8%BF%90%E8%A1%8C%E4%B8%8E%E7%BB%93%E6%9E%9C%E9%AA%8C%E8%AF%81"><span class="toc-number">5.</span> <span class="toc-text"> 5. 运行与结果验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E5%90%AF%E5%8A%A8%E6%8E%A8%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text"> 5.1 启动推理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E9%A2%84%E6%9C%9F%E8%BE%93%E5%87%BA"><span class="toc-number">5.2.</span> <span class="toc-text"> 5.2 预期输出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8-rtx-5070-wsl-%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%BA%E8%A1%8C%E8%B7%91%E9%80%9A-sam-3d%E4%B8%80%E5%9C%BA%E8%B7%A8%E8%B6%8A%E8%BD%AF%E7%A1%AC%E4%BB%B6%E4%BB%A3%E6%B2%9F%E7%9A%84%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95"><span class="toc-number">6.</span> <span class="toc-text"> 在 RTX 5070 + WSL 环境下强行跑通 SAM 3D：一场跨越软硬件代沟的踩坑实录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E4%BE%9D%E8%B5%96%E7%BC%BA%E5%A4%B1%E4%B8%8E%E4%BC%AA%E9%80%A0%E6%88%98%E6%9C%AF-the-mocking-game"><span class="toc-number">6.1.</span> <span class="toc-text"> 第一阶段：依赖缺失与“伪造”战术 (The Mocking Game)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%91-1pytorch3d-%E6%A8%A1%E5%9D%97%E7%BC%BA%E5%A4%B1%E4%B8%8E-visualization-%E6%8A%A5%E9%94%99"><span class="toc-number">6.1.1.</span> <span class="toc-text"> 坑 1：PyTorch3D 模块缺失与 Visualization 报错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%91-2transform3d-%E7%9A%84%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8%E9%99%B7%E9%98%B1"><span class="toc-number">6.1.2.</span> <span class="toc-text"> 坑 2：Transform3d 的链式调用陷阱</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%95%B0%E6%8D%AE%E6%B5%81%E4%B8%8E%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%B8%A5%E8%8B%9B%E6%A0%A1%E9%AA%8C"><span class="toc-number">6.2.</span> <span class="toc-text"> 第二阶段：数据流与类型的严苛校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%91-3mask-%E7%9A%84%E6%95%B0%E5%80%BC%E6%BA%A2%E5%87%BA"><span class="toc-number">6.2.1.</span> <span class="toc-text"> 坑 3：Mask 的数值溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%91-4%E7%BB%B4%E5%BA%A6%E4%B8%8E%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80-assertionerror"><span class="toc-number">6.2.2.</span> <span class="toc-text"> 坑 4：维度与类型断言 (AssertionError)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%98%BE%E5%AD%98%E5%8D%B1%E6%9C%BA-oom-%E4%B8%8E-5070-%E7%9A%84%E6%9E%B6%E6%9E%84%E5%A2%99"><span class="toc-number">6.3.</span> <span class="toc-text"> 第三阶段：显存危机 (OOM) 与 5070 的架构墙</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%91-512gb-%E6%98%BE%E5%AD%98%E7%9A%84%E6%9E%81%E9%99%90%E4%B8%8E%E8%B4%AA%E5%A9%AA%E5%8A%A0%E8%BD%BD"><span class="toc-number">6.3.1.</span> <span class="toc-text"> 坑 5：12GB 显存的极限与贪婪加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%91-6blackwell-%E6%9E%B6%E6%9E%84-sm_120-%E7%9A%84%E6%8E%92%E6%96%A5%E5%8F%8D%E5%BA%94"><span class="toc-number">6.3.2.</span> <span class="toc-text"> 坑 6：Blackwell 架构 (sm_120) 的排斥反应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5%E7%BC%96%E8%AF%91%E5%9C%B0%E7%8B%B1-nightly-build-vs-legacy-code"><span class="toc-number">6.4.</span> <span class="toc-text"> 第四阶段：编译地狱 (Nightly Build vs Legacy Code)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%91-7kaolin-%E4%B8%8E-pytorch3d-%E7%9A%84-c-abi-%E5%86%B2%E7%AA%81"><span class="toc-number">6.4.1.</span> <span class="toc-text"> 坑 7：Kaolin 与 PyTorch3D 的 C++ ABI 冲突</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%91-8gsplat-%E7%9A%84%E6%AD%BB%E5%BE%AA%E7%8E%AF"><span class="toc-number">6.4.2.</span> <span class="toc-text"> 坑 8：Gsplat 的死循环</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E9%98%B6%E6%AE%B5%E7%BB%88%E5%B1%80%E4%B9%8B%E6%88%98-the-hybrid-solution"><span class="toc-number">6.5.</span> <span class="toc-text"> 第五阶段：终局之战 (The Hybrid Solution)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E7%9C%9F-gsplat-%E5%81%87%E8%BE%85%E5%8A%A9%E5%BA%93"><span class="toc-number">6.5.1.</span> <span class="toc-text"> 最终解决方案：真 Gsplat + 假辅助库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">6.5.2.</span> <span class="toc-text"> 结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-takeaway"><span class="toc-number">6.5.3.</span> <span class="toc-text"> 总结 (Takeaway)</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/27/%E7%A5%9E%E7%BB%8F%E9%9A%90%E5%BC%8F%E5%87%A0%E4%BD%95%E4%B8%8E%E5%8F%AF%E5%BE%AE%E6%B8%B2%E6%9F%93%E4%B8%AD%E7%9A%84%E7%9A%84%E5%BA%95%E5%B1%82%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AE%A1%E7%AE%97%E7%AE%A1%E7%BA%BF%EF%BC%9A%E4%BB%8E%E5%9C%BA%E8%AE%BA%E5%9F%BA%E7%A1%80%E5%88%B0%E7%89%A9%E7%90%86%E7%BA%A6%E6%9D%9F/" title="神经隐式几何与可微渲染中的的底层数学原理与计算管线：从场论基础到物理约束"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/8eb85bb13982d5a8187fee8a42adf1bc1a95a704.webp?_r_=b6c79946-9f9b-14a9-768d-4e3fe90e1c6c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="神经隐式几何与可微渲染中的的底层数学原理与计算管线：从场论基础到物理约束"/></a><div class="content"><a class="title" href="/2025/12/27/%E7%A5%9E%E7%BB%8F%E9%9A%90%E5%BC%8F%E5%87%A0%E4%BD%95%E4%B8%8E%E5%8F%AF%E5%BE%AE%E6%B8%B2%E6%9F%93%E4%B8%AD%E7%9A%84%E7%9A%84%E5%BA%95%E5%B1%82%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AE%A1%E7%AE%97%E7%AE%A1%E7%BA%BF%EF%BC%9A%E4%BB%8E%E5%9C%BA%E8%AE%BA%E5%9F%BA%E7%A1%80%E5%88%B0%E7%89%A9%E7%90%86%E7%BA%A6%E6%9D%9F/" title="神经隐式几何与可微渲染中的的底层数学原理与计算管线：从场论基础到物理约束">神经隐式几何与可微渲染中的的底层数学原理与计算管线：从场论基础到物理约束</a><time datetime="2025-12-27T14:15:16.000Z" title="发表于 2025-12-27 22:15:16">2025-12-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/27/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95%E5%88%9D%E8%AF%86%EF%BC%9A%E6%B2%83%E7%BD%97%E8%AF%BA%E4%BC%8A%E5%9B%BE%E4%B8%8E%E5%BE%B7%E5%8A%B3%E5%86%85%E4%B8%89%E8%A7%92%E5%89%96%E5%88%86%EF%BC%88Voronoi-Diagram-Delaunay-Triangulation%EF%BC%89/" title="计算几何初识：沃罗诺伊图与德劳内三角剖分（Voronoi Diagram &amp; Delaunay Triangulation）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/%E3%80%90Pixiv%E7%94%BB%E5%B8%88%E7%B2%BE%E9%80%89%EF%BC%88132%EF%BC%89%E3%80%91%E5%85%AB%E4%B8%89_988777.webp?_r_=6a197e71-8178-1e56-19fb-7a045db6d2ad" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算几何初识：沃罗诺伊图与德劳内三角剖分（Voronoi Diagram &amp; Delaunay Triangulation）"/></a><div class="content"><a class="title" href="/2025/12/27/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95%E5%88%9D%E8%AF%86%EF%BC%9A%E6%B2%83%E7%BD%97%E8%AF%BA%E4%BC%8A%E5%9B%BE%E4%B8%8E%E5%BE%B7%E5%8A%B3%E5%86%85%E4%B8%89%E8%A7%92%E5%89%96%E5%88%86%EF%BC%88Voronoi-Diagram-Delaunay-Triangulation%EF%BC%89/" title="计算几何初识：沃罗诺伊图与德劳内三角剖分（Voronoi Diagram &amp; Delaunay Triangulation）">计算几何初识：沃罗诺伊图与德劳内三角剖分（Voronoi Diagram &amp; Delaunay Triangulation）</a><time datetime="2025-12-27T13:33:52.000Z" title="发表于 2025-12-27 21:33:52">2025-12-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/27/%E7%A7%AF%E5%88%86%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="积分复习笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/91953835_p0.webp?_r_=fec10ec7-0f77-cd33-5564-b0887b1c042a" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="积分复习笔记"/></a><div class="content"><a class="title" href="/2025/12/27/%E7%A7%AF%E5%88%86%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="积分复习笔记">积分复习笔记</a><time datetime="2025-12-27T11:52:58.000Z" title="发表于 2025-12-27 19:52:58">2025-12-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/26/%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B%E9%80%9F%E6%88%90%E7%AC%94%E8%AE%B0/" title="微分方程速成笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/114477837_p0_master1200.webp?_r_=914e50fd-7b3a-db92-7fd2-8ad5f428ced2" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微分方程速成笔记"/></a><div class="content"><a class="title" href="/2025/12/26/%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B%E9%80%9F%E6%88%90%E7%AC%94%E8%AE%B0/" title="微分方程速成笔记">微分方程速成笔记</a><time datetime="2025-12-26T03:53:29.000Z" title="发表于 2025-12-26 11:53:29">2025-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/17/%E9%AB%98%E6%95%B0%E4%B8%8A%E6%9E%81%E9%99%90%E7%AB%A0%E8%8A%82%E9%94%99%E9%A2%98%E9%9B%86/" title="高数上极限章节错题集"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pub-f8d3afa0c3274f1e943ee2f8c45dff96.r2.dev/8eb85bb13982d5a8187fee8a42adf1bc1a95a704.webp?_r_=10b09899-3a23-ad43-7f57-58b917d38bd4" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="高数上极限章节错题集"/></a><div class="content"><a class="title" href="/2025/12/17/%E9%AB%98%E6%95%B0%E4%B8%8A%E6%9E%81%E9%99%90%E7%AB%A0%E8%8A%82%E9%94%99%E9%A2%98%E9%9B%86/" title="高数上极限章节错题集">高数上极限章节错题集</a><time datetime="2025-12-17T15:11:25.000Z" title="发表于 2025-12-17 23:11:25">2025-12-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="Tianxingleo" target="_blank">Tianxingleo</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">42</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">63</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://tianxingleo.github.io" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/237200863?v=4" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/tianxingleo" title="Github"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://github.githubassets.com/assets/GitHub-Mark-ea2971cee799.png" alt="Github"/><span class="back-menu-item-text">Github</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/3dgs/" style="font-size: 0.88rem;">3dgs<sup>7</sup></a><a href="/tags/5070/" style="font-size: 0.88rem;">5070<sup>1</sup></a><a href="/tags/Nerfstudio/" style="font-size: 0.88rem;">Nerfstudio<sup>1</sup></a><a href="/tags/SAM3D/" style="font-size: 0.88rem;">SAM3D<sup>1</sup></a><a href="/tags/blackwell/" style="font-size: 0.88rem;">blackwell<sup>2</sup></a><a href="/tags/c/" style="font-size: 0.88rem;">c<sup>4</sup></a><a href="/tags/colmap/" style="font-size: 0.88rem;">colmap<sup>4</sup></a><a href="/tags/cpc/" style="font-size: 0.88rem;">cpc<sup>4</sup></a><a href="/tags/cpp/" style="font-size: 0.88rem;">cpp<sup>14</sup></a><a href="/tags/css/" style="font-size: 0.88rem;">css<sup>1</sup></a><a href="/tags/cuda/" style="font-size: 0.88rem;">cuda<sup>1</sup></a><a href="/tags/dp/" style="font-size: 0.88rem;">dp<sup>1</sup></a><a href="/tags/google-colab/" style="font-size: 0.88rem;">google colab<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/key%E7%A4%BE/" style="font-size: 0.88rem;">key社<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>5</sup></a><a href="/tags/mask/" style="font-size: 0.88rem;">mask<sup>1</sup></a><a href="/tags/nerfstudio/" style="font-size: 0.88rem;">nerfstudio<sup>1</sup></a><a href="/tags/pytorch/" style="font-size: 0.88rem;">pytorch<sup>3</sup></a><a href="/tags/sam/" style="font-size: 0.88rem;">sam<sup>1</sup></a><a href="/tags/sam3/" style="font-size: 0.88rem;">sam3<sup>1</sup></a><a href="/tags/tic/" style="font-size: 0.88rem;">tic<sup>1</sup></a><a href="/tags/wsl/" style="font-size: 0.88rem;">wsl<sup>5</sup></a><a href="/tags/yolo/" style="font-size: 0.88rem;">yolo<sup>1</sup></a><a href="/tags/%E4%B8%8D%E5%AE%9A%E7%A7%AF%E5%88%86/" style="font-size: 0.88rem;">不定积分<sup>1</sup></a><a href="/tags/%E5%87%BD%E6%95%B0/" style="font-size: 0.88rem;">函数<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 0.88rem;">前端<sup>1</sup></a><a href="/tags/%E5%8A%A8%E6%BC%AB/" style="font-size: 0.88rem;">动漫<sup>1</sup></a><a href="/tags/%E5%A4%A7%E5%AD%A6/" style="font-size: 0.88rem;">大学<sup>8</sup></a><a href="/tags/%E5%A4%A9%E4%BD%BF%E7%9A%84%E5%BF%83%E8%B7%B3/" style="font-size: 0.88rem;">天使的心跳<sup>1</sup></a><a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size: 0.88rem;">字符串<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">学习<sup>6</sup></a><a href="/tags/%E6%8C%87%E9%92%88/" style="font-size: 0.88rem;">指针<sup>2</sup></a><a href="/tags/%E6%90%9C%E7%B4%A2/" style="font-size: 0.88rem;">搜索<sup>1</sup></a><a href="/tags/%E7%A7%AF%E5%88%86/" style="font-size: 0.88rem;">积分<sup>2</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>6</sup></a><a href="/tags/%E7%BB%93%E6%9E%84%E4%BD%93/" style="font-size: 0.88rem;">结构体<sup>1</sup></a><a href="/tags/%E8%B4%A8%E6%95%B0%E7%AD%9B/" style="font-size: 0.88rem;">质数筛<sup>2</sup></a><a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 0.88rem;">链表<sup>1</sup></a><a href="/tags/%E9%AB%98%E6%95%B0/" style="font-size: 0.88rem;">高数<sup>7</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("14/10/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Tianxingleo 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: '',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'G-NVDE0BFR5M', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>